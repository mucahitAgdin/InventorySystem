@{
    ViewData["Title"] = "Scan & Lookup";
    Layout = "_Layout"; // Mevcut genel layout; admin layout kullanıyorsan onu yaz
}

<div class="container py-4">
    <h2 class="mb-3">Scan & Lookup</h2>

    <!-- 🔹 Barkod okuyucu HID (klavye) gibi yazar, Enter ile bitirir -->
    <form id="scanForm" class="mb-3" autocomplete="off">
        @Html.AntiForgeryToken() <!-- JS için token kaynağı -->
        <div class="input-group input-group-lg">
            <input id="barcodeInput" class="form-control"
                   placeholder="Focus burada iken barkodu okutun..."
                   autocomplete="off" autofocus />
            <button class="btn btn-primary" type="submit">Lookup</button>
        </div>
        <small class="text-muted">Zebra DS3678 (HID): Okutma sonunda Enter gönderir.</small>
    </form>

    <!-- 🔹 Sonuç kartı -->
    <div id="resultPanel" class="d-none">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h4 id="pName" class="mb-1"></h4>
                        <div id="pMeta" class="text-muted small"></div>
                        <div id="pSerial" class="mt-1 small"></div>
                    </div>
                    <span id="pStockBadge" class="badge rounded-pill"></span>
                </div>

                <hr />
                <!-- 🔹 Aksiyon alanı: Mevcut /Stock/In ve /Stock/Out POST'larına SUBMIT -->
                <div class="row g-2">
                    <div class="col-md-6">
                        <button id="btnIn" class="btn btn-success w-100" disabled>
                            Mark as IN (to Depot)
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button id="btnOut" class="btn btn-warning w-100" disabled>
                            Mark as OUT
                        </button>
                    </div>
                </div>

                <!-- OUT için gerekli alanlar -->
                <div id="outForm" class="mt-3 d-none">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input id="deliveredTo" class="form-control" placeholder="Delivered To (person/unit)" />
                        </div>
                        <div class="col-md-4">
                            <input id="deliveredBy" class="form-control" placeholder="Delivered By" />
                        </div>
                        <div class="col-md-4">
                            <input id="note" class="form-control" placeholder="Note (optional)" />
                        </div>
                    </div>
                    <button id="btnOutConfirm" class="btn btn-warning mt-2">Confirm OUT</button>
                </div>

                <div id="alerts" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- 🔹 Gizli formlar (mevcut StockController POST’larına submit için) -->
    <form id="formIn" method="post" action="/Stock/In" class="d-none">
        @Html.AntiForgeryToken()
        <input name="Barcode" />
        <input name="DeliveredBy" />
        <input name="Note" />
    </form>

    <form id="formOut" method="post" action="/Stock/Out" class="d-none">
        @Html.AntiForgeryToken()
        <input name="Barcode" />
        <input name="DeliveredTo" />
        <input name="DeliveredBy" />
        <input name="Note" />
    </form>
</div>

@section Scripts {
    <script src="~/js/scanner.js" asp-append-version="true"></script>
}
