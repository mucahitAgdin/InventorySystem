@* Views/Stock/Scan.cshtml
   Purpose:
   - Scan & lookup page for barcode-based operations.
   - Uses IViewLocalizer to pull strings from:
     Resources/Views/Stock/Scan.{culture}.resx
   Notes:
   - Structure unchanged; hidden forms + js hooks preserved.
*@
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["PageTitle"];
    Layout = "_Layout";
}

<div class="container py-4">
    <h2 class="mb-3">@Localizer["Header"]</h2>

    <!-- 🔹 HID scanner types like keyboard, sends Enter -->
    <form id="scanForm" class="mb-3" autocomplete="off">
        @Html.AntiForgeryToken()
        <div class="input-group input-group-lg">
            <input id="barcodeInput" class="form-control"
                   placeholder="@Localizer["PlaceholderScan"]"
                   autocomplete="off" autofocus />
            <button class="btn btn-primary" type="submit">
                @Localizer["BtnLookup"]
            </button>
        </div>
        <small class="text-muted d-block mt-1">
            @Localizer["LookupHelp"]
        </small>
    </form>

    <!-- 🔹 Result card (populated by scanner.js) -->
    <div id="resultPanel" class="d-none">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h4 id="pName" class="mb-1"></h4>
                        <div id="pMeta" class="text-muted small"></div>
                        <div id="pSerial" class="mt-1 small"></div>
                    </div>
                    <span id="pStockBadge" class="badge rounded-pill"></span>
                </div>

                <hr />
                <div class="row g-2">
                    <div class="col-md-6">
                        <button id="btnIn" class="btn btn-success w-100" disabled>
                            @Localizer["BtnMarkIn"]
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button id="btnOut" class="btn btn-warning w-100" disabled>
                            @Localizer["BtnMarkOut"]
                        </button>
                    </div>
                </div>

                <div id="outForm" class="mt-3 d-none">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input id="deliveredTo" class="form-control"
                                   placeholder="@Localizer["DeliveredTo"]" />
                        </div>
                        <div class="col-md-4">
                            <input id="deliveredBy" class="form-control"
                                   placeholder="@Localizer["DeliveredBy"]" />
                        </div>
                        <div class="col-md-4">
                            <input id="note" class="form-control"
                                   placeholder="@Localizer["Note"]" />
                        </div>
                    </div>
                    <button id="btnOutConfirm" class="btn btn-warning mt-2">
                        @Localizer["BtnConfirmOut"]
                    </button>
                </div>

                <div id="alerts" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- 🔹 Hidden legacy forms kept for compatibility -->
    <form id="formIn" method="post" action="/Stock/In" class="d-none">
        @Html.AntiForgeryToken()
        <input name="Barcode" />
        <input name="DeliveredBy" />
        <input name="Note" />
    </form>

    <form id="formOut" method="post" action="/Stock/Out" class="d-none">
        @Html.AntiForgeryToken()
        <input name="Barcode" />
        <input name="DeliveredTo" />
        <input name="DeliveredBy" />
        <input name="Note" />
    </form>
</div>

@section Scripts {
    <script src="~/js/scanner.js" asp-append-version="true"></script>
}
