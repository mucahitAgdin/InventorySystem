@using InventorySystem.ViewModels
@model InventorySystem.ViewModels.StockMoveVm

@{
    ViewData["Title"] = "Stok Hareketi";
}

<div class="container py-4 move-page">
    <h2 class="move-title mb-3">Stok Giriş / Çıkış</h2>

    <!-- 🔹 Barkod Okuma / Lookup (scanner.js ile) -->
    <form id="scanForm" class="mb-3" autocomplete="off">
        @Html.AntiForgeryToken() <!-- JS için token kaynağı -->
        <div class="input-group input-group-lg">
            <input id="barcodeInput" class="form-control"
                   placeholder="Barkodu okutun veya yazıp Enter’a basın…" autocomplete="off" autofocus />
            <button class="btn btn-forvia-accent" type="submit">Lookup</button>
        </div>
        <small class="move-help">Zebra DS3678 (HID) tarayıcı okutma sonunda Enter gönderir.</small>
    </form>

    <!-- 🔹 Lookup Sonucu (bilgi amaçlı) -->
    <div id="resultPanel" class="card d-none mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                    <div id="pName"></div>
                    <div id="pMeta"></div>
                    <div id="pSerial"></div>

                    <div class="p-info-row mt-2">
                        <span id="pBarcodeChip" class="info-chip" data-help="Sistemde kayıtlı benzersiz barkod"></span>
                        <span id="pLocationChip" class="info-chip" data-help="Ürünün güncel konumu"></span>
                    </div>
                </div>
                <span id="pStockBadge" class="badge rounded-pill"></span>
            </div>
        </div>
    </div>

    <!-- 🔹 TEK KART: Stok Hareketi Onayı -->
    <div class="card move-card border-0">
        <div class="card-header text-white" style="background: var(--forvia-blue-grad);">
            Confirm Transaction
        </div>
        <div class="card-body">
            <form asp-action="Confirm" asp-controller="Stock" method="post" novalidate class="row g-3" id="confirmForm">
                @Html.AntiForgeryToken()
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <!-- Barkod -->
                <div class="col-12 col-md-6">
                    <label asp-for="Barcode" class="form-label"></label>
                    <input asp-for="Barcode" class="form-control" id="moveBarcode"
                           placeholder="Lütfen barkodu okutun veya yazın" />
                    <span asp-validation-for="Barcode" class="text-danger small"></span>
                </div>

                <!-- Location (required) -->
                <div class="col-12 col-md-6">
                    <label asp-for="Location" class="form-label">Location</label>
                    <select asp-for="Location" class="form-select" id="moveLocation"
                            asp-items="Html.GetEnumSelectList<MoveLocation>()">
                                
                    </select>
                    <span class="text-muted d-block mt-1 small">Seçenekler: depo, ofis, stok dışı</span>
                    <span asp-validation-for="Location" class="text-danger small"></span>
                </div>

                <!-- DeliveredBy (opsiyonel) -->
                <div class="col-12 col-md-6">
                    <label asp-for="DeliveredBy" class="form-label"></label>
                    <input asp-for="DeliveredBy" class="form-control"
                           placeholder="İşlemi yapan kişi (opsiyonel)" />
                    <span asp-validation-for="DeliveredBy" class="text-danger small"></span>
                </div>

                <!-- Note (opsiyonel) -->
                <div class="col-12">
                    <label asp-for="Note" class="form-label"></label>
                    <textarea asp-for="Note" class="form-control" rows="2"
                              placeholder="Not (opsiyonel)"></textarea>
                    <span asp-validation-for="Note" class="text-danger small"></span>
                </div>

                <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-forvia-primary">
                        Confirm Transaction
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 🔹 (GÜNCEL) Gizli form — scanner.js tek POST için kullanacak -->
    <form id="formConfirm" method="post" action="/Stock/Confirm" class="d-none">
        @Html.AntiForgeryToken()
        <input name="Barcode" />
        <input name="Location" />
        <input name="DeliveredBy" />
        <input name="Note" />
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/scanner.js" asp-append-version="true"></script>
}
